# Android 打包分析 - xiaowang_lj - 博客园
- URL: https://www.cnblogs.com/wanglongjiang/p/17248365.html
- Added At: 2024-10-18 10:07:08
- [Link To Text](2024-10-18-android-打包分析---xiaowang_lj---博客园_raw.md)

## TL;DR
文章讨论了APK大小差异、CPU架构适配、原生代码影响、APK架构判断、不同架构兼容性、第三方库处理及64位架构适配策略，强调了通过`build.gradle`配置支持多架构的重要性。

## Summary
1. **APK大小差异**：
   - **问题描述**：`make project`生成的APK大小约为15M，而运行到设备上的APK大小约为5M。
   - **差异分析**：主要差异在于`lib`文件夹下的内容。

2. **APK分包原因**：
   - **CPU架构多样性**：安卓设备的CPU架构包括ARM和x86，分为32位和64位。
   - **适配策略**：为适配不同CPU架构，APK分为32位安装包、32位64位兼容包和64位安装包。

3. **影响适配的因素**：
   - **原生代码**：原生代码（C/C++）决定APK适配的架构，因为Java代码通过JNI调用原生代码实现底层调度。

4. **判断APK支持的CPU架构**：
   - **方法一**：通过查看APK安装包中的`lib`文件夹下的库文件。
   - **方法二**：查看`build.gradle`文件中的`abiFilters`配置。

5. **不同CPU架构的兼容性**：
   - **加载机制**：Android设备会优先加载对应架构的`.so`文件，若无对应文件则尝试加载`armeabi`下的文件。
   - **适配建议**：同时包含`armeabi`、`armeabi-v7a`和`x86`可以覆盖大多数设备，但会导致包变大。

6. **第三方平台的`.so`库处理**：
   - **兼容策略**：若第三方库只提供`armeabi`下的`.so`文件，需复制到其他架构文件夹中以确保兼容性。

7. **适配64位架构的政策**：
   - **原因**：Arm架构将逐步限制32位应用的运行，未来旗舰机将只支持64位应用。
   - **解决方案**：确保应用包含64位库，对于每种原生32位架构，应用必须包含相应的64位架构。

8. **构建支持不同架构的APK**：
   - **配置方法**：修改`build.gradle`文件中的`abiFilters`值，然后进行打包。
